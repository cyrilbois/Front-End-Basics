# CentOS 入门

## 文件管理

### 根目录下的文件和目录

![](https://cdn.jsdelivr.net/gh/qiqihaobenben/picture/2021-8-31/1630408372889-image.png)

根据颜色区分：

- 蓝色：表示文件夹
- 灰色：表示普通文件
- 绿色：表示可执行文件
- 红色：表示压缩文件
- 天蓝色：表示链接文件（快捷方式）

常用的目录：

- bin：存放普通用户可执行的指令，普通用户也可以执行；
- boot：开机引导目录，包括 Linux 内核文件与开机所需要的文件；
- dev：设备目录，所有的硬件设备及周边均放置在这个设备目录中；
- home：这里主要存放你的个人数据，具体每个用户的设置文件，用户的桌面文件夹，还有用户的数据都放在这里。每个用户都有自己的用户目录，位置为：`/home/用户名`。当然，root 用户除外；
- usr：应用程序放置目录
- lib：开机时常用的动态链接库，bin 及 sbin 指令也会调用对应的 lib 库；
- tmp：临时文件存放目录；
- etc：各种配置文件目录，大部分配置属性均放在在这里；
- opt：第三方软件安装目录，现在习惯性的放置在 `usr/local`中；
- var：存放系统执行过程经常改变的文件，其中有一个重要的目录就是 `/var/log/目录`，主要存放的是系统日志文件。

### 目录文件相关的命令和快捷键

| 命令            | 作用                                   |
| --------------- | -------------------------------------- |
| `pwd`           | 显示当前目录完成路径，shell 脚本中常用 |
| `mkdir`         | 创建目录                               |
| `touch`         | 创建文件                               |
| `rm` (`rm -rf`) | 删除文件（目录）                       |
| `rmdir`         | 删除空文件夹                           |
| `find`          | 查找文件                               |
| `man`/`info`    | 获取帮助                               |

| 快捷键   | 作用         |
| -------- | ------------ |
| ctrl + u | 清空至行首   |
| ctrl + k | 清空至行尾   |
| ctrl + l | 清屏         |
| ctrl + c | 终止执行命令 |

### tree 命令查看目录树

系统本身没有安装 `tree` 命令，所以要首先安装一下 `sudo yum -y install tree`

### 查看文件内容

除了 vi 可以使用 vim 编辑器打开文件外，还有一些常见的查看文件内容的命令：

| 命令                                       | 作用                               |
| ------------------------------------------ | ---------------------------------- |
| `more`/`less`                              | 浏览文件全部内容                   |
| `cat` (`cat -n`)                           | 查看文件内容（显示行号）           |
| `grep` (`grep <关键字> <要查找的文件> -n`) | 在文本文件中查找字符串（显示行号） |

### 管道符

管道符将一个命令的执行结果作为另一个命令的输入来执行，格式 `cmd1 | cmd2 ... | cmdn`

例一：将 `/etc` 目录中的文件名以 pass 开头的文件列举出来 `ls /etc | grep pass*`

例二：查看 `/etc` 目录下的内容，并使用 less 的形式浏览 `ls /etc | less`

## systemctl 命令

```sh
#开机运行服务
systemctl enable *.service
#取消开机运行
systemctl disable *.service
#启动服务
systemctl start *.service
#停止服务
systemctl stop *.service
#重启服务
systemctl restart *.service
#重新加载服务配置文件
systemctl reload *.service
#查询服务运行状态
systemctl status *.service
#显示启动失败的服务
systemctl --failed
```

## 进程管理

进程是正在执行的一个程序或命令，每一个进程都是一个运行的实体，都有自己的地址空间，并占用一定的系统资源。

进程管理最重要的就是 `ps` 命令：

- `ps aux`：查看系统中所有进程，使用 BSD 操作系统格式。
- `ps -le`：查看系统中所有进程，使用 Linux 标准命令格式。

`ps aux` 命令输出大约如下图所示：

![](https://cdn.jsdelivr.net/gh/qiqihaobenben/picture/2021-9-1/1630462129937-image.png)

输出的格式含义：

- USER：该进程是由哪个用户产生的；
- PID：进程的 ID；
- %CPU：进程占 CPU 资源的百分比；
- %MEM：进程占用物理内存的百分比；
- VSZ：进程占虚拟内存的大小，单位 KB；
- RSS：进程占用实际物理内存的大小，单位 KB；
- TTY：进程在哪个终端运行的，tty1-tty7 代表本地控制台终端，tty1-tty6 是本地的字符界面终端，tty7 是图形终端，pts/0-255 代表虚拟终端，如果是 ? 则代表是系统进程。
- STAT：进程状态，R-运行，S-睡眠，T-停止，s-包含子进程，+-位于后台；
- START：进程启动时间；
- TIME：进程占用 CPU 的运行时间，注意不是系统时间；
- COMMAND：产生此进程的命令名；

### pstree

`pstree` 命令，可以显示进程树

### top

`top` 命令，可以查看系统的健康状态，跟 Windows 系统中的系统管理器类似。

`top` 命令的交互模式中可以执行下面的命令（需要注意大小写）：

- `?`/`h`：显示交互模式的帮助；
- `P`：以 CPU 使用率排序，默认就是此项；
- `M`：以内存的使用率排序；
- `N`：以 PID 排序；
- `q`：退出 `top`;

![](https://cdn.jsdelivr.net/gh/qiqihaobenben/picture/2021-9-1/1630470666169-image.png)

参照上图说一些字段的含义：

- load average 后面的三个数字的意思，分别为系统在之前 1 分钟，5 分钟，15 分钟的平均负载，一般认为小于 1 时，负载较小。如果大于 1，系统已经超过符合。如果是多核 CPU，那么这个数字应该不大于你的 CPU 核心数，比如双核 CPU 时应该不大于 2。
- Tasks 后面的 zombie，意思为僵尸进程，一般是进程无法正常运行，也没有正常退出，通俗的说就是卡住了，也有可能这个进程正在终止过程中，如果稍微等待一下还存在，那么就需要手动检查一下。
- %CPU(s)的 id 是比较重要的指标，以为空闲 CPU 的百分比，如果低于 20，那么系统的状态就比较卡了。

### 杀死进程

杀死进程主要有下面几个命令：

| 命令      | 作用                                               |
| --------- | -------------------------------------------------- |
| `kill`    | 杀死某个进程                                       |
| `killall` | 按照进程名杀死进程                                 |
| `pkill`   | 按照进程名杀死进程，加 `-t` 可以按照终端号踢出用户 |

杀死进程时可以跟信号，常用的信号如下：

| 信号代号 | 信号名称 | 说明                                                                                                    |
| -------- | -------- | ------------------------------------------------------------------------------------------------------- |
| 1        | SIGHUP   | 让进程立即关闭，然后重新读取配置文件之后重启，平滑重启                                                  |
| 2        | SIGINT   | 程序终止信号，用于终止前台进程，相当于 ctrl + c 快捷键                                                  |
| 9        | SIGKILL  | 强制终止，用来立即结束程序的运行，本信号不能被屏蔽、处理和忽略                                          |
| 15       | SIGTERM  | 正常结束的信号，`kill` 命令默认就是这个信号，有时候进程已经发生问题，正常无法终止，此时会使用 `-9` 信号 |

### 修改进程优先级

可以使用 `ps -le | less` 查看进程的优先级：

![](https://cdn.jsdelivr.net/gh/qiqihaobenben/picture/2021-9-1/1630491191110-image.png)

下面的两个值都是优先级，数字越小代表改进程优先级越高。

- PRI 代表 Priority，用户不能修改

- NI 代表 Nice，用户可以修改，NI 值的返回是-20 到 19，普通用户调整 NI 值的范围是 0-19，并且只能调整自己的进程，root 用户才能设定进程 NI 值为负值。

可以使用 `nice` 命令来修改优先级，`nice <选项> 命令`，选项 `-n 值` 给命令赋予 NI 值。nice 命令可以给新执行的命令直接赋予 NI 值，但是不能修改已存在的 NI 值的进程。例如，修改 apache 的进程优先级 `nice -n 5 service httpd start`。

如果要修改已存在的进程的优先级，需要使用 `renice` 命令， `renice <优先级> PID`，PID 为某一个进程的 ID。例如：`renice -10 2125` 修改 ID 2125 的进程 NI 值为 -10。

## 工作管理

- 当前的登录终端，只能管理当前终端的工作，而不能管理其他登录终端的工作；
- 放入后台的命令必须可以持续运行一段时间，这样我们才能捕捉和操作这个工作；
- 放入后台执行的命令不能和前台用户有交互或者需要前台输入，否则放入后台只能暂停，而不能执行；

### 把进程放入后台有两个主要命令：

1. `<命令> &` 把命令放入后台，并在后台执行
2. `<命令>` 执行后按下 ctrl + z 快捷键，放入后台暂停

查看正在后台的工作，可以使用 `jobs [-l]` 命令， `-l` 是显示工作的 PID。

### 恢复操作：

- `fg %工作号` 将后台暂停的工作恢复到前台执行，这里的 % 可以省略，不过要注意工作号和 PID 的区别（工作号类似于 1，2 这样的序号）；
- `bg %工作号` 将后台暂停的工作恢复到后台执行，后台恢复执行的命令，是不能和前台有交互的，否则不能恢复到后台执行；

### 让程序始终在后台执行

如果让程序始终在后台执行，及时关闭当前的终端也执行（之前的 `&` 做不到），有以下三种方法可以实现：

1. 把需要后台执行的命令加入 `/etc/rc.local` 文件；
2. 使用系统定时任务，让系统在指定的时间执行某个后台命令；
3. 使用 `nohup` 命令，该命令可以是在你退出账户/关闭终端之后继续运行相应的进程

`nohup` 命令的使用方法 `nohup <命令> &` ，nohup.out 日志可以使用 `tail -fn nohub.out` 查看

关闭终端后，在另一个终端 `jobs` 已经无法看到后台跑的程序了，此时利用 `ps aux` 可以看到所有进程。

关于前台后台进程切换，可以查看：[Linux 程序前台后台切换](https://www.cnblogs.com/geogre123/p/10643152.html)

### 推荐阅读

- [CentOS 根目录下各目录介绍](https://zhuanlan.zhihu.com/p/46279950)
